# Transaction Import Guide

This document outlines the process of importing transactions from a CSV file, from the initial file upload to the final review and approval of the formatted data.

## Overview

The transaction import functionality is designed to streamline the process of adding new transactions from external sources. It automates data cleaning, categorization, and formatting, while providing a comprehensive review step to ensure data accuracy. The entire workflow is managed within the **Transaction Import Modal**.

## Step-by-Step Process

### 1. File Upload and Parsing

The process begins when you select a CSV file for import.

- **File Selection**: The user selects an account to import transactions into and chooses a CSV file.
- **Parsing**: The system uses the `papaparse` library to read the file and process it row by row. Only rows with data are processed; empty lines are skipped.

### 2. Data Transformation and Cleaning

For each row of data from the CSV, a series of transformations are applied to clean and standardize the information:

- **Data Standardization**: The system maps various possible column headers from the CSV (e.g., "Description," "Appears On Your Statement As") to a consistent internal format.
- **Location Formatting**: Address, city, state, and zip code are combined into a single, clean location string.
- **Merchant Name Cleaning**:
  - The system first checks for a user-defined **custom merchant name**. If one exists for the raw merchant data, it is used.
  - If no custom name is found, the raw merchant name is cleaned to remove common noise (e.g., "CHECKCARD," "SQ\*") and redundant location information.
- **Description Formatting**: A concise and clean description is generated by combining the `description` and `extended_details` fields, while removing redundant data like the merchant name and location.

### 3. Suggestion Generation

Once the data is cleaned, the system generates intelligent suggestions for the transaction's details:

- **Category and Sub-Category**: A multi-layered approach is used to suggest a category:
  1.  **Merchant History**: The system first checks for categories previously assigned to the same merchant.
  2.  **Merchant Patterns**: If no history is found, it looks for predefined patterns in the merchant name.
  3.  **Keyword Matching**: As a fallback, it matches keywords in the transaction description to a list of categories.
- **Transaction Type**: The system determines if the transaction is an `income` or `expense` based on the amount and the type of account (e.g., positive amounts in a checking account are income, while positive amounts on a credit card are expenses).
- **Recurring Status**: The system scans the description for keywords like "monthly" or "subscription" to predict if the transaction is recurring.

### 4. Review and Approval

The final step is the review process, where the user can see the original data alongside the system's proposed suggestions.

- **Transaction Card**: Each transaction is displayed in a "Transaction Card," which shows the raw data from the CSV on the left and the cleaned, editable suggestions on the right.
- **User Interaction**: The user can:
  - Accept the suggestions as they are.
  - Edit any of the suggested fields (merchant, description, category, etc.).
  - Fill in additional details, such as notes.
- **Approval**: Once all required fields are filled, the "Approve" button becomes active, allowing the user to approve the transaction for import.

This structured process ensures that imported data is clean, consistent, and accurately categorized, while still giving the user full control over the final result.
